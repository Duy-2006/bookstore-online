<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:replace="~{admin/layout :: admin_layout(~{::body})}">
<head>
    <title th:text="${book.id == null ? 'Nhập Sách Mới' : 'Cập Nhật Thông Tin Sách'}"></title>
</head>
<body>
    
    <div class="container-fluid p-0 animate__animated animate__fadeIn">
        <div class="row justify-content-center">
            <div class="col-lg-10"> 
                
                <div class="card border-0 shadow-lg mt-3 mb-5">
                    <div class="card-header text-white py-3"
                         style="background: linear-gradient(135deg, var(--primary-blue), var(--secondary-blue)); border-radius: 0.5rem 0.5rem 0 0;">
                        <h5 class="m-0 fw-bold text-uppercase d-flex align-items-center">
                            <i class="fa-solid fa-book-medical me-2" th:if="${book.id == null}"></i>
                            <i class="fa-solid fa-pen-to-square me-2" th:if="${book.id != null}"></i>
                            <span th:text="${book.id == null ? 'Nhập Sách Mới' : 'Cập Nhật Thông Tin Sách'}"></span>
                        </h5>
                    </div>

                    <div class="card-body p-4 bg-white">
                        
                        <form th:action="@{/admin/books/save}" th:object="${book}" method="post" enctype="multipart/form-data">
                            <input type="hidden" th:field="*{id}"/>

                            <h6 class="text-primary fw-bold mb-3 text-uppercase border-bottom pb-2"><i class="fa-solid fa-circle-info me-1"></i> Thông tin chung</h6>
                            
                            <div class="row">
                                <div class="col-md-8 mb-4">
                                    <label class="form-label fw-bold text-secondary">Tên sách <span class="text-danger">*</span></label>
                                    <div class="input-group">
                                        <span class="input-group-text bg-light"><i class="fa-solid fa-book text-muted"></i></span>
                                        <input type="text" class="form-control" th:field="*{title}" placeholder="Nhập tên sách..." required
                                               th:classappend="${#fields.hasErrors('title')} ? 'is-invalid' : ''">
                                        <div class="invalid-feedback" th:errors="*{title}">Lỗi tên sách</div>
                                    </div>
                                </div>

                                <div class="col-md-4 mb-4">
                                    <label class="form-label fw-bold text-secondary">Mã ISBN</label>
                                    <div class="input-group">
                                        <span class="input-group-text bg-light"><i class="fa-solid fa-barcode text-muted"></i></span>
                                        <input type="text" class="form-control" th:field="*{isbn}" placeholder="Mã vạch..."
                                               th:classappend="${#fields.hasErrors('isbn')} ? 'is-invalid' : ''">
                                        <div class="invalid-feedback" th:errors="*{isbn}">Lỗi ISBN</div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-4 mb-4">
                                    <label class="form-label fw-bold text-secondary">Tác giả</label>
                                    <div class="input-group">
                                        <span class="input-group-text bg-light"><i class="fa-solid fa-user-pen text-muted"></i></span>
                                        <select class="form-select" th:field="*{author}">
                                            <option value="">-- Chọn tác giả --</option>
                                            <option th:each="a : ${authors}" th:value="${a.id}" th:text="${a.name}"></option>
                                        </select>
                                    </div>
                                </div>

                                <div class="col-md-4 mb-4">
                                    <label class="form-label fw-bold text-secondary">Nhà xuất bản</label>
                                    <div class="input-group">
                                        <span class="input-group-text bg-light"><i class="fa-solid fa-building text-muted"></i></span>
                                        <input type="text" class="form-control" th:field="*{publisher}" placeholder="NXB...">
                                    </div>
                                </div>
                                
                                <div class="col-md-4 mb-4">
                                    <label class="form-label fw-bold text-secondary">Thể loại</label>
                                    <div class="input-group">
                                        <span class="input-group-text bg-light"><i class="fa-solid fa-layer-group text-muted"></i></span>
                                        <select class="form-select" th:field="*{category}">
                                            <option value="">-- Chọn thể loại --</option>
                                            <option th:each="cat : ${categories}" th:value="${cat.id}" th:text="${cat.name}"></option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <h6 class="text-primary fw-bold mb-3 mt-2 text-uppercase border-bottom pb-2"><i class="fa-solid fa-sack-dollar me-1"></i> Dữ liệu Kinh doanh</h6>
                            
                            <div class="row">
                                <div class="col-md-4 mb-4">
                                    <label class="form-label fw-bold text-secondary">Giá bán <span class="text-danger">*</span></label>
                                    <div class="input-group">
                                        <input type="number" class="form-control fw-bold text-end text-danger" th:field="*{price}" min="0" step="1000" required
                                               th:classappend="${#fields.hasErrors('price')} ? 'is-invalid' : ''">
                                        <span class="input-group-text bg-light fw-bold">VNĐ</span>
                                        <div class="invalid-feedback" th:errors="*{price}">Lỗi giá</div>
                                    </div>
                                </div>

                                <div class="col-md-4 mb-4">
                                    <label class="form-label fw-bold text-secondary">Số lượng tồn</label>
                                    <div class="input-group">
                                        <span class="input-group-text bg-light"><i class="fa-solid fa-boxes-stacked text-muted"></i></span>
                                        <input type="number" class="form-control fw-bold" th:field="*{quantity}" min="0" required
                                               th:classappend="${#fields.hasErrors('quantity')} ? 'is-invalid' : ''">
                                        <div class="invalid-feedback" th:errors="*{quantity}">Lỗi số lượng</div>
                                    </div>
                                </div>

                                <div class="col-md-4 mb-4 d-flex align-items-center">
                                    <div class="form-check form-switch mt-4 ps-5">
                                        <input class="form-check-input" type="checkbox" role="switch" id="activeSwitch" 
                                               th:field="*{active}" style="transform: scale(1.3);">
                                        <label class="form-check-label fw-bold ms-2 text-success" for="activeSwitch">Đang kinh doanh</label>
                                    </div>
                                </div>
                            </div>

                            <h6 class="text-primary fw-bold mb-3 mt-2 text-uppercase border-bottom pb-2"><i class="fa-solid fa-image me-1"></i> Hình ảnh & Nội dung</h6>

                            <div class="row">
                                <div class="col-md-4 mb-4">
                                    <label class="form-label fw-bold text-secondary">Ảnh bìa</label>
                                    <input type="file" name="imageFile" class="form-control" accept="image/*" 
                                           onchange="document.getElementById('blah').src = window.URL.createObjectURL(this.files[0])">
                                    
                                    <div class="mt-3 text-center border rounded p-2 bg-light d-flex align-items-center justify-content-center" style="min-height: 200px;">
                                        <img id="blah" 
                                             th:src="${book.imageUrl != null} ? @{/images/books/{img}(img=${book.imageUrl})} : 'https://placehold.co/200x300?text=Preview'" 
                                             class="img-fluid rounded shadow-sm" 
                                             style="max-height: 250px; object-fit: contain;">
                                    </div>
                                </div>

                                <div class="col-md-8 mb-4">
                                    <label class="form-label fw-bold text-secondary">Mô tả chi tiết</label>
                                    <textarea class="form-control" th:field="*{description}" rows="10" placeholder="Viết mô tả về nội dung sách..."></textarea>
                                </div>
                            </div>

                            <div class="d-flex gap-2 justify-content-end pt-3 border-top">
                                <a th:href="@{/admin/books}" class="btn btn-light border fw-bold px-4 hover-shadow">
                                    <i class="fa-solid fa-arrow-left me-1"></i> Hủy bỏ
                                </a>
                                <button type="submit" class="btn btn-primary fw-bold px-4 shadow-sm hover-scale"
                                        style="background: linear-gradient(135deg, var(--primary-blue), var(--secondary-blue)); border: none;">
                                    <i class="fa-solid fa-floppy-disk me-1"></i> Lưu Sách
                                </button>
                            </div>

                        </form>
                    </div>
                </div>

            </div>
        </div>
    </div>
</body>
</html>